<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Bookmark.Title}} - My Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }

        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        function confirmDelete() {
            return confirm("Are you sure you want to delete this bookmark? This action cannot be undone.");
        }

        function toggleEditNote() {
            const viewDiv = document.getElementById('note-view');
            const editDiv = document.getElementById('note-edit');
            if (viewDiv && editDiv) {
                viewDiv.classList.toggle('hidden');
                editDiv.classList.toggle('hidden');
            }
        }
    </script>
    <style>
        /* Typography for content */
        .prose {
            color: #374151;
        }

        .dark .prose {
            color: #d1d5db;
        }

        .prose img {
            margin: 1rem auto;
            max-width: 100%;
            border-radius: 0.5rem;
        }

        .prose h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #111827;
        }

        .dark .prose h1 {
            color: #f9fafb;
        }

        .prose h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .dark .prose h2 {
            color: #f3f4f6;
        }

        .prose p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .prose a {
            color: #2563eb;
            text-decoration: underline;
        }

        .dark .prose a {
            color: #60a5fa;
        }

        .prose ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .prose blockquote {
            border-left: 4px solid #e5e7eb;
            padding-left: 1rem;
            font-style: italic;
            color: #4b5563;
        }

        .dark .prose blockquote {
            border-color: #4b5563;
            color: #9ca3af;
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen p-4 md:p-8 transition-colors duration-200">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 flex justify-between items-center">
            <div>
                <a href="/" class="text-blue-600 dark:text-blue-400 hover:underline mb-2 inline-block">&larr; Back to
                    Archive</a>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">#{{.Bookmark.ID}}
                    {{.Bookmark.Title}}</h1>
                <div class="mt-2 text-gray-500 dark:text-gray-400 text-sm">
                    Saved on {{.Bookmark.CreatedAt.Format "Jan 02, 2006"}} |
                    <a href="{{.Bookmark.URL}}" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">Original Source</a>
                </div>
            </div>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition ml-4">
                üåó
            </button>
        </header>

        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Sidebar / Notes (First on Mobile, Second on Desktop) -->
            <div class="lg:w-1/3 lg:order-2">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md sticky top-8">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">My Notes</h3>

                    <!-- View Mode -->
                    <div id="note-view" class="{{if not .Bookmark.Comment}}hidden{{end}}">
                        <div class="prose dark:prose-invert text-sm mb-4 whitespace-pre-wrap text-gray-700 dark:text-gray-300">{{if .Bookmark.Comment}}{{.Bookmark.Comment}}{{else}}No notes yet.{{end}}</div>
                        <button onclick="toggleEditNote()" class="w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white py-2 px-4 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">Edit Note</button>
                    </div>
                    <!-- Edit Mode -->
                    <div id="note-edit" class="{{if .Bookmark.Comment}}hidden{{end}}">
                        <form action="/bookmarks/{{.Bookmark.ID}}/comment" method="POST">
                            <textarea name="comment" rows="15" class="w-full p-3 border rounded mb-4 bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Add a note...">{{.Bookmark.Comment}}</textarea>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition">Save
                                Note</button>
                            {{if .Bookmark.Comment}}
                            <button type="button" onclick="toggleEditNote()" class="mt-2 w-full text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-sm py-2">Cancel</button>
                            {{end}}
                        </form>
                    </div>

                    <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-500 dark:text-gray-400 flex justify-between items-end">
                        <div>
                            <p><strong>ID for Notebook:</strong> <span class="text-2xl font-mono text-black dark:text-white block mt-1">#{{.Bookmark.ID}}</span>
                            </p>
                        </div>
                        <form action="/bookmarks/{{.Bookmark.ID}}/delete" method="POST" onsubmit="return confirmDelete()">
                            <button type="submit" class="text-red-500 hover:text-red-700 text-sm font-medium px-2 py-1">Delete</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Main Content (Second on Mobile, First on Desktop) -->
            <div class="lg:w-2/3 lg:order-1">
                <div class="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-lg shadow-md">
                    {{if .Bookmark.Content}}
                    <div class="prose max-w-none">
                        {{.Bookmark.Content | safeHTML}}
                    </div>
                    {{else}}
                    <div class="text-center py-12 bg-gray-50 dark:bg-gray-700/50 rounded border border-gray-200 dark:border-gray-700">
                        <p class="text-gray-600 dark:text-gray-300 mb-4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç.</p>
                        <a href="{{.Bookmark.URL}}" target="_blank" class="inline-block bg-blue-600 text-white py-2 px-6 rounded hover:bg-blue-700 transition">
                            –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
                        </a>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>
</body>

</html>